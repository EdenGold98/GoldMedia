<?xml version="1.0"?>
<root xmlns="urn:schemas-upnp-org:device-1-0" xmlns:dlna="urn:schemas-dlna-org:device-1-0" xmlns:sec="http://www.sec.co.kr/dlna">
    <specVersion>
        <major>1</major>
        <minor>0</minor>
    </specVersion>
    <device>
        <deviceType>urn:schemas-upnp-org:device:MediaServer:1</deviceType>
        <!-- === THE FIX: Impersonate Windows Media Player === -->
        <friendlyName>{{ server_name }}</friendlyName>
        <manufacturer>Microsoft Corporation</manufacturer>
        <manufacturerURL>http://www.microsoft.com</manufacturerURL>
        <modelDescription>Windows Media Player DLNA Server</modelDescription>
        <modelName>Windows Media Player</modelName>
        <modelNumber>12.0</modelNumber>
        <modelURL>http://www.microsoft.com</modelURL>
        <UDN>uuid:{{ server_uuid }}</UDN>
        <presentationURL>http://{{ server_ip }}:{{ server_port }}</presentationURL>
        
        <dlna:X_DLNADOC>DMS-1.50</dlna:X_DLNADOC>
        <dlna:X_DLNADOC>M-DMS-1.50</dlna:X_DLNADOC>
        <dlna:X_DLNACAP/>
        <sec:ProductCap>smi,DCM10,getMediaInfo.sec,getCaptionInfo.sec</sec:ProductCap>
        <sec:X_ProductCap>smi,DCM10,getMediaInfo.sec,getCaptionInfo.sec</sec:X_ProductCap>

        <iconList>
            {% if custom_icon_exists %}
            <icon>
                <mimetype>image/png</mimetype><width>256</width><height>256</height><depth>24</depth>
                <url>/images/custom_icon.png</url>
            </icon>
            <icon>
                <mimetype>image/png</mimetype><width>128</width><height>128</height><depth>24</depth>
                <url>/images/custom_icon.png</url>
            </icon>
            <icon>
                <mimetype>image/png</mimetype><width>48</width><height>48</height><depth>24</depth>
                <url>/images/custom_icon.png</url>
            </icon>
            {% else %}
            <icon>
                <mimetype>image/png</mimetype><width>256</width><height>256</height><depth>24</depth>
                <url>/images/icon-256.png</url>
            </icon>
            <icon>
                <mimetype>image/png</mimetype><width>128</width><height>128</height><depth>24</depth>
                <url>/images/icon-128.png</url>
            </icon>
            <icon>
                <mimetype>image/png</mimetype><width>48</width><height>48</height><depth>24</depth>
                <url>/images/icon-48.png</url>
            </icon>
            {% endif %}
        </iconList>

        <serviceList>
            <service>
                <serviceType>urn:schemas-upnp-org:service:ContentDirectory:1</serviceType>
                <serviceId>urn:upnp-org:serviceId:ContentDirectory</serviceId>
                <SCPDURL>/scpd/ContentDirectory.xml</SCPDURL>
                <controlURL>/upnp/control/ContentDirectory</controlURL>
                <eventSubURL>/upnp/event/ContentDirectory</eventSubURL>
            </service>
            <service>
                <serviceType>urn:schemas-upnp-org:service:ConnectionManager:1</serviceType>
                <serviceId>urn:upnp-org:serviceId:ConnectionManager</serviceId>
                <SCPDURL>/scpd/ConnectionManager.xml</SCPDURL>
                <controlURL>/upnp/control/ConnectionManager</controlURL>
                <eventSubURL>/upnp/event/ConnectionManager</eventSubURL>
            </service>
            <service>
                <serviceType>urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1</serviceType>
                <serviceId>urn:microsoft.com:serviceId:X_MS_MediaReceiverRegistrar</serviceId>
                <SCPDURL>/scpd/X_MS_MediaReceiverRegistrar.xml</SCPDURL>
                <controlURL>/upnp/control/X_MS_MediaReceiverRegistrar</controlURL>
                <eventSubURL>/upnp/event/X_MS_MediaReceiverRegistrar</eventSubURL>
            </service>
        </serviceList>
    </device>
</root>